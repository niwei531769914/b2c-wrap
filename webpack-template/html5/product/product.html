<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>购物车</title>
    <meta name="description" content="">
    <meta name="Keywords" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no,email=no">
    <link href="../common/css/common.css" rel="stylesheet">
    <script src="../common/js/zepto.min.js"></script>
    <script src="js/swiper.min.js"></script>
    <link href="css/swiper.min.css" rel="stylesheet">
    <link href="css/product.css" rel="stylesheet" type="text/css">

</head>
<body>

<div class="page">
    <div class="header-dom">
        <div class="hy-header-warp">
            <header class="hy-header-nav">
                <a href="javascript: void (0)" class="summary current">基本信息</a>
                <a href="javascript: void (0)" class="desc">商品详情</a>
                <a href="javascript: void (0)" class="review">评价172</a>
            </header>
        </div>
    </div>

    <div id="content" class="content">
        <div class="hy-page-scroll swiper-container">
            <div class="swiper-wrapper">
                <div class="swiper-slide hy-summary" id="hy-basic" style="transform: translateY(0px) ; overflow: auto">
                    <div id="scroller">
                        1
                        <div class="top-scroll">继续拖动，查看详情</div>
                    </div>

                </div>
                <div class="swiper-slide hy-summary" style="overflow: auto">
                    <div class="last-scroll">下拉回到基本信息</div>
                    <div id="tscroller">

                    </div>
                </div>
                <div class="swiper-slide hy-summary" style="overflow: auto">
                    <div id="thscroller">

                    </div>
                </div>
            </div>
        </div>
    </div>


    <!--底部按钮-->
    <div class="hy-actionBar-container">
        <div class="action-bar-wrap">
            <ul class="action-other">
                <li class="item service"></li>
                <li class="item favourite"></li>
                <li class="item shop"></li>
            </ul>
            <a href="javascript: void (0)" class="item addtocart">立即购买</a>
            <a href="javascript: void (0)" class="item buy">加入购物车</a>
        </div>
    </div>

</div>


</body>
<script type="text/javascript">
    window.onload = function () {

        document.getElementById('scroller').scrollTop = 50;

        //计算content的高度
        function Height() {
            let Windowheight =  document.documentElement.clientHeight ;

            document.getElementById('content').style.height = (Windowheight - 91) + 'px';

            $('.swiper-slide').height(Windowheight - 91);
        }

        Height();
        
        let swiper = new Swiper('.swiper-container', {
            visibilityFullFit: true,
            loop: false,
            speed: 300,
            onSlideChangeStart: function () {
                $('.hy-header-nav .current').removeClass('current');
                $('.hy-header-nav a').eq(swiper.activeIndex).addClass('current');
                $(window).scrollTop(0);
            }
        });

        $('.hy-header-nav a').click(function () {
            let Index = $(this).index();
            swiper.slideTo(Index, 300, false);
            $('.hy-header-nav .current').removeClass('current');
            $(this).addClass('current');
            $(window).scrollTop(0);
        });


        let Iscroll = function (dom) {
            //初始化数据
            let init = {
                startY: 0,
                touchY: 0,
                pax: 0,
                scrollY: 0,
                juli: 0,
                widthY: 0,
                Docheight: 0,
                Windowheight: 0,
                ScrollTop: 0
            };

            dom.addEventListener('touchstart', (event) => {

                //初始化滚动距离
                init.scrollY = 0;

                init.Docheight = dom.clientHeight;
                init.Windowheight =  document.documentElement.clientHeight ;

                //touch中touchstrat开始获取滚动条高度
                init.ScrollTop = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop;
                init.startY = event.targetTouches[0].pageY;
                let le = dom.style.transform || dom.style.webkitTransform;
                dom.style.transition = '';
                init.pax = parseFloat(le.substr(11));
            }, false);

            dom.addEventListener('touchmove', (event) => {

                //touch中监听滚动条高度
                init.ScrollTop = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop;
                init.touchY = event.targetTouches[0].pageY;
                init.juli = parseFloat(init.startY) - parseFloat(init.touchY);
                init.scrollY = -init.juli + init.pax;
                dom.style.transition = 'none';
                if (init.ScrollTop == 0) {
                    if (init.juli < 0) {
                        //顶部不能回弹
                        if (init.scrollY >= 0) {
                            dom.style.transform = 'translateY(0px)';
                            return false;
                        }
                    }
                }
                if ((init.Docheight - init.Windowheight) ==  (init.ScrollTop - 91) ) {

                    if (init.juli > 0) {

                        event.preventDefault();//阻止触摸时浏览器的缩放、滚动条滚动
                        dom.style.transform = 'translateY(' + init.scrollY + 'px)';

                    }

                }
            }, false);

            dom.addEventListener('touchend', () => {
                if ((init.Docheight - init.Windowheight) ==  (init.ScrollTop - 91) ) {
                    if (-init.scrollY > 80) {
                        dom.style.transform = 'translateY(0px)';
                        dom.style.transition = '-webkit-transform 0.3s cubic-bezier(0.333333, 0.666667, 0.666667, 1)';
                        swiper.slideTo(1, 300, false);
                        $('.hy-header-nav .current').removeClass('current');
                        $('.hy-header-nav a').eq(1).addClass('current');
                        $(window).scrollTop(0);
                        return false;
                    }
                }
                dom.style.transform = 'translateY(0px)';
                dom.style.transition = '-webkit-transform 0.3s cubic-bezier(0.333333, 0.666667, 0.666667, 1)';

            }, false)
        };

        let DOM = document.getElementById('hy-basic');

        new Iscroll(DOM);
    }
</script>
</html>